<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Réparation des Boutons</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; background: #f5f5f5; }
        .test-container { background: white; padding: 2rem; border-radius: 0.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .button { padding: 0.75rem 1.5rem; margin: 0.5rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer; }
        .button:hover { background: #2563eb; }
        .status { padding: 1rem; margin: 1rem 0; border-radius: 0.25rem; }
        .success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
        .info { background: #dbeafe; color: #1e40af; border: 1px solid #3b82f6; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 Test de Réparation des Boutons CV</h1>
        
        <div class="status info">
            <strong>Instructions :</strong><br>
            1. Ouvrez la console du navigateur (F12)<br>
            2. Cliquez sur "Lancer le Test" pour vérifier si les scripts fonctionnent<br>
            3. Cliquez sur "Ouvrir le CV" pour accéder à l'application principale
        </div>
        
        <div id="test-results"></div>
        
        <button class="button" onclick="runRepairTest()">🔧 Lancer le Test de Réparation</button>
        <button class="button" onclick="window.open('index.html', '_blank')">📄 Ouvrir le CV</button>
        <button class="button" onclick="location.reload()">🔄 Recharger</button>
    </div>

    <script>
        function runRepairTest() {
            console.log('🧪 TEST: Starting repair test...');
            const resultsDiv = document.getElementById('test-results');
            
            // Test 1: Vérifier si les scripts existent
            const tests = [
                {
                    name: 'Script de réparation',
                    test: () => fetch('button_repair.js').then(r => r.ok),
                    description: 'Vérifie si button_repair.js existe'
                },
                {
                    name: 'Script de diagnostic',
                    test: () => fetch('diagnostic.js').then(r => r.ok),
                    description: 'Vérifie si diagnostic.js existe'
                },
                {
                    name: 'Page principale',
                    test: () => fetch('index.html').then(r => r.ok),
                    description: 'Vérifie si index.html existe'
                },
                {
                    name: 'LocalStorage',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return Promise.resolve(true);
                        } catch (e) {
                            return Promise.resolve(false);
                        }
                    },
                    description: 'Vérifie si localStorage fonctionne'
                }
            ];
            
            resultsDiv.innerHTML = '<div class="status info">🧪 Tests en cours...</div>';
            
            Promise.all(tests.map(test => 
                test.test().then(result => ({ ...test, result })).catch(() => ({ ...test, result: false }))
            )).then(results => {
                const passed = results.filter(r => r.result).length;
                const total = results.length;
                
                let html = `<div class="status ${passed === total ? 'success' : 'error'}">
                    <strong>Résultats des tests : ${passed}/${total} réussis</strong>
                </div>`;
                
                results.forEach(result => {
                    html += `<div style="padding: 0.5rem; margin: 0.25rem 0; background: ${result.result ? '#f0fdf4' : '#fef2f2'}; border-radius: 0.25rem;">
                        ${result.result ? '✅' : '❌'} <strong>${result.name}</strong>: ${result.description}
                    </div>`;
                });
                
                if (passed === total) {
                    html += `<div class="status success">
                        <strong>✅ Tous les tests sont passés !</strong><br>
                        Vous pouvez maintenant ouvrir le CV. Les scripts de réparation devraient fonctionner.
                    </div>`;
                } else {
                    html += `<div class="status error">
                        <strong>❌ Certains tests ont échoué</strong><br>
                        Vérifiez que tous les fichiers sont présents dans le même dossier.
                    </div>`;
                }
                
                resultsDiv.innerHTML = html;
            });
        }
        
        // Test automatique au chargement
        window.addEventListener('load', () => {
            console.log('🧪 TEST: Page de test chargée');
            setTimeout(() => {
                document.getElementById('test-results').innerHTML = `
                    <div class="status info">
                        <strong>🎯 Prêt pour les tests</strong><br>
                        Cliquez sur "Lancer le Test" pour vérifier l'état des scripts.
                    </div>
                `;
            }, 500);
        });
    </script>
</body>
</html>